<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025 래랑가로스 (HOSU - OPEN)</title>
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f4f8;
            color: #333;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 960px;
            margin: 0 auto;
        }
        h1 {
            font-size: 2.5rem;
            text-align: center;
            background: linear-gradient(to right, #1A3C34, #2A6B5B);
            color: #D4A017;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        p {
            text-align: center;
            font-size: 1.1rem;
            color: #666;
            margin-bottom: 20px;
        }
        .section {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h2 {
            font-size: 1.8rem;
            color: #333;
            margin-bottom: 15px;
        }
        .note {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 15px;
        }
        details summary {
            background: #f9fafb;
            padding: 10px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1.1rem;
            margin-bottom: 10px;
        }
        details summary:hover {
            background: #e5e7eb;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            overflow-x: auto;
            display: block;
        }
        th, td {
            padding: 10px;
            text-align: center;
            border: 1px solid #ddd;
            min-width: 80px;
        }
        th {
            background: linear-gradient(to right, #1A3C34, #2A6B5B);
            color: #fff;
        }
        tr:hover {
            background: #f1f5f9;
        }
        input[type="text"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        input[type="text"]:focus {
            outline: none;
            border-color: #D4A017;
            box-shadow: 0 0 4px rgba(212,160,23,0.5);
        }
        .best-partner, .worst-partner {
            min-width: 120px;
        }
        td:has(.best-partner), td:has(.worst-partner) {
            min-width: 120px;
        }
        .btn {
            display: inline-block;
            padding: 10px 20px;
            margin: 10px 5px;
            background: #D4A017;
            color: #333;
            text-decoration: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        .btn:hover {
            background: #e5b520;
        }
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #2A6B5B;
            color: #fff;
            padding: 10px 20px;
            border-radius: 4px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .toast.show {
            opacity: 1;
        }
        @media (max-width: 640px) {
            h1 {
                font-size: 1.8rem;
            }
            th, td {
                font-size: 0.9rem;
                padding: 6px;
                min-width: 60px;
            }
            .best-partner, .worst-partner, td:has(.best-partner), td:has(.worst-partner) {
                min-width: 100px;
            }
            input[type="text"] {
                font-size: 0.8rem;
                padding: 6px;
            }
            .btn {
                padding: 8px 15px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>2025 래랑가로스 (HOSU - OPEN)</h1>
        <p><strong>기간:</strong> 2025년 6월</p>

        <div class="section">
            <h2>회차별 게임 스케줄</h2>
            <p class="note">참고: 1세트, 6게임제, 노애드 스코어링, 순위는 승리 게임 수, 게임득실 순 (게임득실 = 획득 게임 - 실점 게임)</p>
            <details>
                <summary>1회차</summary>
                <table class="schedule-table">
                    <tr>
                        <th>플레이어 1</th>
                        <th>플레이어 2</th>
                        <th>vs</th>
                        <th>플레이어 3</th>
                        <th>플레이어 4</th>
                        <th>스코어</th>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="이름" class="player1"></td>
                        <td><input type="text" placeholder="이름" class="player2"></td>
                        <td>vs</td>
                        <td><input type="text" placeholder="이름" class="player3"></td>
                        <td><input type="text" placeholder="이름" class="player4"></td>
                        <td><input type="text" placeholder="예: 6-4" class="score"></td>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="이름" class="player1"></td>
                        <td><input type="text" placeholder="이름" class="player2"></td>
                        <td>vs</td>
                        <td><input type="text" placeholder="이름" class="player3"></td>
                        <td><input type="text" placeholder="이름" class="player4"></td>
                        <td><input type="text" placeholder="예: 6-4" class="score"></td>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="이름" class="player1"></td>
                        <td><input type="text" placeholder="이름" class="player2"></td>
                        <td>vs</td>
                        <td><input type="text" placeholder="이름" class="player3"></td>
                        <td><input type="text" placeholder="이름" class="player4"></td>
                        <td><input type="text" placeholder="예: 6-4" class="score"></td>
                    </tr>
                </table>
            </details>
            <details>
                <summary class="font-medium text-lg">2회차</summary>
                <table class="schedule-table w-full bg-white">
                    <tr class="tennis-green text-white">
                        <th>플레이어 1</th>
                        <th>플레이어 2</th>
                        <th>vs</th>
                        <th>플레이어 3</th>
                        <th>플레이어 4</th>
                        <th>스코어</th>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="이름" class="player1 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player2 w-full"></td>
                        <td>vs</td>
                        <td><input type="text" placeholder="이름" class="player3 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player4 w-full"></td>
                        <td><input type="text" placeholder="예: 6-4" class="score w-full"></td>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="이름" class="player1 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player2 w-full"></td>
                        <td>vs</td>
                        <td><input type="text" placeholder="이름" class="player3 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player4 w-full"></td>
                        <td><input type="text" placeholder="예: 6-4" class="score w-full"></td>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="이름" class="player1 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player2 w-full"></td>
                        <td>vs</td>
                        <td><input type="text" placeholder="이름" class="player3 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player4 w-full"></td>
                        <td><input type="text" placeholder="예: 6-4" class="score w-full"></td>
                    </tr>
                </table>
            </details>
            <details>
                <summary class="font-medium text-lg">3회차</summary>
                <table class="schedule-table w-full bg-white">
                    <tr class="tennis-green text-white">
                        <th>플레이어 1</th>
                        <th>플레이어 2</th>
                        <th>vs</th>
                        <th>플레이어 3</th>
                        <th>플레이어 4</th>
                        <th>스코어</th>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="이름" class="player1 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player2 w-full"></td>
                        <td>vs</td>
                        <td><input type="text" placeholder="이름" class="player3 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player4 w-full"></td>
                        <td><input type="text" placeholder="예: 6-4" class="score w-full"></td>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="이름" class="player1 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player2 w-full"></td>
                        <td>vs</td>
                        <td><input type="text" placeholder="이름" class="player3 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player4 w-full"></td>
                        <td><input type="text" placeholder="예: 6-4" class="score w-full"></td>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="이름" class="player1 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player2 w-full"></td>
                        <td>vs</td>
                        <td><input type="text" placeholder="이름" class="player3 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player4 w-full"></td>
                        <td><input type="text" placeholder="예: 6-4" class="score w-full"></td>
                    </tr>                    </tr>
                </table>
            </details>
            <details>
                <summary class="font-medium text-lg">4회차</summary>
                <table class="schedule-table w-full bg-white">
                    <tr class="tennis-green text-white">
                        <th>플레이어 1</th>
                        <th>플레이어 2</th>
                        <th>vs</th>
                        <th>플레이어 3</th>
                        <th>플레이어 4</th>
                        <th>스코어</th>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="이름" class="player1 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player2 w-full"></td>
                        <td>vs</td>
                        <td><input type="text" placeholder="이름" class="player3 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player4 w-full"></td>
                        <td><input type="text" placeholder="예: 6-4" class="score w-full"></td>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="이름" class="player1 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player2 w-full"></td>
                        <td>vs</td>
                        <td><input type="text" placeholder="이름" class="player3 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player4 w-full"></td>
                        <td><input type="text" placeholder="예: 6-4" class="score w-full"></td>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="이름" class="player1 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player2 w-full"></td>
                        <td>vs</td>
                        <td><input type="text" placeholder="이름" class="player3 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player4 w-full"></td>
                        <td><input type="text" placeholder="예: 6-4" class="score w-full"></td>
                    </tr>
                </table>
            </details>
            <details>
                <summary class="font-medium text-lg">5회차</summary>
                <table class="schedule-table w-full bg-white">
                    <tr class="tennis-green text-white">
                        <th>플레이어 1</th>
                        <th>플레이어 2</th>
                        <th>vs</th>
                        <th>플레이어 3</th>
                        <th>플레이어 4</th>
                        <th>스코어</th>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="이름" class="player1 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player2 w-full"></td>
                        <td>vs</td>
                        <td><input type="text" placeholder="이름" class="player3 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player4 w-full"></td>
                        <td><input type="text" placeholder="예: 6-4" class="score w-full"></td>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="이름" class="player1 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player2 w-full"></td>
                        <td>vs</td>
                        <td><input type="text" placeholder="이름" class="player3 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player4 w-full"></td>
                        <td><input type="text" placeholder="예: 6-4" class="score w-full"></td>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="이름" class="player1 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player2 w-full"></td>
                        <td>vs</td>
                        <td><input type="text" placeholder="이름" class="player3 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player4 w-full"></td>
                        <td><input type="text" placeholder="예: 6-4" class="score w-full"></td>
                    </tr>
                </table>
            </details>
            <details>
                <summary class="font-medium text-lg">6회차</summary>
                <table class="schedule-table w-full bg-white">
                    <tr class="tennis-green text-white">
                        <th>플레이어 1</th>
                        <th>플레이어 2</th>
                        <th>vs</th>
                        <th>플레이어 3</th>
                        <th>플레이어 4</th>
                        <th>스코어</th>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="이름" class="player1 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player2 w-full"></td>
                        <td>vs</td>
                        <td><input type="text" placeholder="이름" class="player3 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player4 w-full"></td>
                        <td><input type="text" placeholder="예: 6-4" class="score w-full"></td>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="이름" class="player1 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player2 w-full"></td>
                        <td>vs</td>
                        <td><input type="text" placeholder="이름" class="player3 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player4 w-full"></td>
                        <td><input type="text" placeholder="예: 6-4" class="score w-full"></td>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="이름" class="player1 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player2 w-full"></td>
                        <td>vs</td>
                        <td><input type="text" placeholder="이름" class="player3 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player4 w-full"></td>
                        <td><input type="text" placeholder="예: 6-4" class="score w-full"></td>
                    </tr>
                </table>
            </details>
            <details>
                <summary class="font-medium text-lg">7회차</summary>
                <table class="schedule-table w-full bg-white">
                    <tr class="tennis-green text-white">
                        <th>플레이어 1</th>
                        <th>플레이어 2</th>
                        <th>vs</th>
                        <th>플레이어 3</th>
                        <th>플레이어 4</th>
                        <th>스코어</th>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="이름" class="player1 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player2 w-full"></td>
                        <td>vs</td>
                        <td><input type="text" placeholder="이름" class="player3 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player4 w-full"></td>
                        <td><input type="text" placeholder="예: 6-4" class="score w-full"></td>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="이름" class="player1 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player2 w-full"></td>
                        <td>vs</td>
                        <td><input type="text" placeholder="이름" class="player3 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player4 w-full"></td>
                        <td><input type="text" placeholder="예: 6-4" class="score w-full"></td>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="이름" class="player1 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player2 w-full"></td>
                        <td>vs</td>
                        <td><input type="text" placeholder="이름" class="player3 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player4 w-full"></td>
                        <td><input type="text" placeholder="예: 6-4" class="score w-full"></td>
                    </tr>
                </table>
            </details>
            <details>
                <summary class="font-medium text-lg">8회차</summary>
                <table class="schedule-table w-full bg-white">
                    <tr class="tennis-green text-white">
                        <th>플레이어 1</th>
                        <th>플레이어 2</th>
                        <th>vs</th>
                        <th>플레이어 3</th>
                        <th>플레이어 4</th>
                        <th>스코어</th>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="이름" class="player1 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player2 w-full"></td>
                        <td>vs</td>
                        <td><input type="text" placeholder="이름" class="player3 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player4 w-full"></td>
                        <td><input type="text" placeholder="예: 6-4" class="score w-full"></td>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="이름" class="player1 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player2 w-full"></td>
                        <td>vs</td>
                        <td><input type="text" placeholder="이름" class="player3 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player4 w-full"></td>
                        <td><input type="text" placeholder="예: 6-4" class="score w-full"></td>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="이름" class="player1 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player2 w-full"></td>
                        <td>vs</td>
                        <td><input type="text" placeholder="이름" class="player3 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player4 w-full"></td>
                        <td><input type="text" placeholder="예: 6-4" class="score w-full"></td>
                    </tr>
                </table>
            </details>
            <details>
                <summary class="font-medium text-lg">9회차</summary>
                <table class="schedule-table w-full bg-white">
                    <tr class="tennis-green text-white">
                        <th>플레이어 1</th>
                        <th>플레이어 2</th>
                        <th>vs</th>
                        <th>플레이어 3</th>
                        <th>플레이어 4</th>
                        <th>스코어</th>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="이름" class="player1 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player2 w-full"></td>
                        <td>vs</td>
                        <td><input type="text" placeholder="이름" class="player3 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player4 w-full"></td>
                        <td><input type="text" placeholder="예: 6-4" class="score w-full"></td>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="이름" class="player1 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player2 w-full"></td>
                        <td>vs</td>
                        <td><input type="text" placeholder="이름" class="player3 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player4 w-full"></td>
                        <td><input type="text" placeholder="예: 6-4" class="score w-full"></td>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="이름" class="player1 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player2 w-full"></td>
                        <td>vs</td>
                        <td><input type="text" placeholder="이름" class="player3 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player4 w-full"></td>
                        <td><input type="text" placeholder="예: 6-4" class="score w-full"></td>
                    </tr>
                </table>
            </details>
            <details>
                <summary class="font-medium text-lg">10회차</summary>
                <table class="schedule-table w-full bg-white">
                    <tr class="tennis-green text-white">
                        <th>플레이어 1</th>
                        <th>플레이어 2</th>
                        <th>vs</th>
                        <th>플레이어 3</th>
                        <th>플레이어 4</th>
                        <th>스코어</th>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="이름" class="player1 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player2 w-full"></td>
                        <td>vs</td>
                        <td><input type="text" placeholder="이름" class="player3 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player4 w-full"></td>
                        <td><input type="text" placeholder="예: 6-4" class="score w-full"></td>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="이름" class="player1 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player2 w-full"></td>
                        <td>vs</td>
                        <td><input type="text" placeholder="이름" class="player3 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player4 w-full"></td>
                        <td><input type="text" placeholder="예: 6-4" class="score w-full"></td>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="이름" class="player1 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player2 w-full"></td>
                        <td>vs</td>
                        <td><input type="text" placeholder="이름" class="player3 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player4 w-full"></td>
                        <td><input type="text" placeholder="예: 6-4" class="score w-full"></td>
                    </tr>
                </table>
            </details>
            <details>
                <summary class="font-medium text-lg">11회차</summary>
                <table class="schedule-table w-full bg-white">
                    <tr class="tennis-green text-white">
                        <th>플레이어 1</th>
                        <th>플레이어 2</th>
                        <th>vs</th>
                        <th>플레이어 3</th>
                        <th>플레이어 4</th>
                        <th>스코어</th>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="이름" class="player1 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player2 w-full"></td>
                        <td>vs</td>
                        <td><input type="text" placeholder="이름" class="player3 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player4 w-full"></td>
                        <td><input type="text" placeholder="예: 6-4" class="score w-full"></td>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="이름" class="player1 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player2 w-full"></td>
                        <td>vs</td>
                        <td><input type="text" placeholder="이름" class="player3 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player4 w-full"></td>
                        <td><input type="text" placeholder="예: 6-4" class="score w-full"></td>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="이름" class="player1 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player2 w-full"></td>
                        <td>vs</td>
                        <td><input type="text" placeholder="이름" class="player3 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player4 w-full"></td>
                        <td><input type="text" placeholder="예: 6-4" class="score w-full"></td>
                    </tr>
                </table>
            </details>
            <details>
                <summary class="font-medium text-lg">12회차</summary>
                <table class="schedule-table w-full bg-white">
                    <tr class="tennis-green text-white">
                        <th>플레이어 1</th>
                        <th>플레이어 2</th>
                        <th>vs</th>
                        <th>플레이어 3</th>
                        <th>플레이어 4</th>
                        <th>스코어</th>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="이름" class="player1 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player2 w-full"></td>
                        <td>vs</td>
                        <td><input type="text" placeholder="이름" class="player3 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player4 w-full"></td>
                        <td><input type="text" placeholder="예: 6-4" class="score w-full"></td>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="이름" class="player1 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player2 w-full"></td>
                        <td>vs</td>
                        <td><input type="text" placeholder="이름" class="player3 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player4 w-full"></td>
                        <td><input type="text" placeholder="예: 6-4" class="score w-full"></td>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="이름" class="player1 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player2 w-full"></td>
                        <td>vs</td>
                        <td><input type="text" placeholder="이름" class="player3 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player4 w-full"></td>
                        <td><input type="text" placeholder="예: 6-4" class="score w-full"></td>
                    </tr>
                </table>
            </details>
            <details>
                <summary class="font-medium text-lg">13회차</summary>
                <table class="schedule-table w-full bg-white">
                    <tr class="tennis-green text-white">
                        <th>플레이어 1</th>
                        <th>플레이어 2</th>
                        <th>vs</th>
                        <th>플레이어 3</th>
                        <th>플레이어 4</th>
                        <th>스코어</th>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="이름" class="player1 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player2 w-full"></td>
                        <td>vs</td>
                        <td><input type="text" placeholder="이름" class="player3 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player4 w-full"></td>
                        <td><input type="text" placeholder="예: 6-4" class="score w-full"></td>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="이름" class="player1 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player2 w-full"></td>
                        <td>vs</td>
                        <td><input type="text" placeholder="이름" class="player3 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player4 w-full"></td>
                        <td><input type="text" placeholder="예: 6-4" class="score w-full"></td>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="이름" class="player1 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player2 w-full"></td>
                        <td>vs</td>
                        <td><input type="text" placeholder="이름" class="player3 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player4 w-full"></td>
                        <td><input type="text" placeholder="예: 6-4" class="score w-full"></td>
                    </tr>
                </table>
            </details>
            <details>
                <summary class="font-medium text-lg">14회차</summary>
                <table class="schedule-table w-full bg-white">
                    <tr class="tennis-green text-white">
                        <th>플레이어 1</th>
                        <th>플레이어 2</th>
                        <th>vs</th>
                        <th>플레이어 3</th>
                        <th>플레이어 4</th>
                        <th>스코어</th>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="이름" class="player1 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player2 w-full"></td>
                        <td>vs</td>
                        <td><input type="text" placeholder="이름" class="player3 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player4 w-full"></td>
                        <td><input type="text" placeholder="예: 6-4" class="score w-full"></td>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="이름" class="player1 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player2 w-full"></td>
                        <td>vs</td>
                        <td><input type="text" placeholder="이름" class="player3 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player4 w-full"></td>
                        <td><input type="text" placeholder="예: 6-4" class="score w-full"></td>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="이름" class="player1 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player2 w-full"></td>
                        <td>vs</td>
                        <td><input type="text" placeholder="이름" class="player3 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player4 w-full"></td>
                        <td><input type="text" placeholder="예: 6-4" class="score w-full"></td>
                    </tr>
                </table>
            </details>
            <details>
                <summary class="font-medium text-lg">15회차</summary>
                <table class="schedule-table w-full bg-white">
                    <tr class="tennis-green text-white">
                        <th>플레이어 1</th>
                        <th>플레이어 2</th>
                        <th>vs</th>
                        <th>플레이어 3</th>
                        <th>플레이어 4</th>
                        <th>스코어</th>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="이름" class="player1 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player2 w-full"></td>
                        <td>vs</td>
                        <td><input type="text" placeholder="이름" class="player3 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player4 w-full"></td>
                        <td><input type="text" placeholder="예: 6-4" class="score w-full"></td>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="이름" class="player1 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player2 w-full"></td>
                        <td>vs</td>
                        <td><input type="text" placeholder="이름" class="player3 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player4 w-full"></td>
                        <td><input type="text" placeholder="예: 6-4" class="score w-full"></td>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="이름" class="player1 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player2 w-full"></td>
                        <td>vs</td>
                        <td><input type="text" placeholder="이름" class="player3 w-full"></td>
                        <td><input type="text" placeholder="이름" class="player4 w-full"></td>
                        <td><input type="text" placeholder="예: 6-4" class="score w-full"></td>
                    </tr>
                </table>
            </details>
            <button id="update-ranking" class="update-btn w-full mt-4 py-3 bg-gradient-to-r from-yellow-400 to-yellow-500 text-gray-800 font-bold text-lg rounded-lg">순위 업데이트</button>
        </div>

        <div class="section bg-white shadow-md rounded-lg p-4 sm:p-6 mb-8">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">월별 순위표</h2>
            <p class="note">순위 정렬 기준: 1순위 MMR, 2순위 다승, 3순위 게임득실</p>
            <table id="ranking-table" class="w-full bg-white">
                <tr class="tennis-green text-white">
                    <th>순위</th>
                    <th>선수</th>
                    <th>MMR</th>
                    <th>승</th>
                    <th>패</th>
                    <th>게임득실</th>
                    <th>접전승률</th>
                    <th>접전패률</th>
                    <th>압도승률</th>
                    <th>최고승률 파트너</th>
                    <th>최하승률 파트너</th>
                </tr>
                <tr>
                    <td>1</td>
                    <td><input type="text" placeholder="이름" class="ranking-player w-full"></td>
                    <td><input type="text" class="mmr w-full" readonly></td>
                    <td><input type="text" class="wins w-full" readonly></td>
                    <td><input type="text" class="losses w-full" readonly></td>
                    <td><input type="text" class="game-diff w-full" readonly></td>
                    <td><input type="text" class="close-wins w-full" readonly></td>
                    <td><input type="text" class="close-losses w-full" readonly></td>
                    <td><input type="text" class="dominant-wins w-full" readonly></td>
                    <td><input type="text" class="best-partner w-full" readonly></td>
                    <td><input type="text" class="worst-partner w-full" readonly></td>
                </tr>
                <tr>
                    <td>2</td>
                    <td><input type="text" placeholder="이름" class="ranking-player w-full"></td>
                    <td><input type="text" class="mmr w-full" readonly></td>
                    <td><input type="text" class="wins w-full" readonly></td>
                    <td><input type="text" class="losses w-full" readonly></td>
                    <td><input type="text" class="game-diff w-full" readonly></td>
                    <td><input type="text" class="close-wins w-full" readonly></td>
                    <td><input type="text" class="close-losses w-full" readonly></td>
                    <td><input type="text" class="dominant-wins w-full" readonly></td>
                    <td><input type="text" class="best-partner w-full" readonly></td>
                    <td><input type="text" class="worst-partner w-full" readonly></td>
                </tr>
                <tr>
                    <td>3</td>
                    <td><input type="text" placeholder="이름" class="ranking-player w-full"></td>
                    <td><input type="text" class="mmr w-full" readonly></td>
                    <td><input type="text" class="wins w-full" readonly></td>
                    <td><input type="text" class="losses w-full" readonly></td>
                    <td><input type="text" class="game-diff w-full" readonly></td>
                    <td><input type="text" class="close-wins w-full" readonly></td>
                    <td><input type="text" class="close-losses w-full" readonly></td>
                    <td><input type="text" class="dominant-wins w-full" readonly></td>
                    <td><input type="text" class="best-partner w-full" readonly></td>
                    <td><input type="text" class="worst-partner w-full" readonly></td>
                </tr>
                <tr>
                    <td>4</td>
                    <td><input type="text" placeholder="이름" class="ranking-player w-full"></td>
                    <td><input type="text" class="mmr w-full" readonly></td>
                    <td><input type="text" class="wins w-full" readonly></td>
                    <td><input type="text" class="losses w-full" readonly></td>
                    <td><input type="text" class="game-diff w-full" readonly></td>
                    <td><input type="text" class="close-wins w-full" readonly></td>
                    <td><input type="text" class="close-losses w-full" readonly></td>
                    <td><input type="text" class="dominant-wins w-full" readonly></td>
                    <td><input type="text" class="best-partner w-full" readonly></td>
                    <td><input type="text" class="worst-partner w-full" readonly></td>
                </tr>
                <tr>
                    <td>5</td>
                    <td><input type="text" placeholder="이름" class="ranking-player w-full"></td>
                    <td><input type="text" class="mmr w-full" readonly></td>
                    <td><input type="text" class="wins w-full" readonly></td>
                    <td><input type="text" class="losses w-full" readonly></td>
                    <td><input type="text" class="game-diff w-full" readonly></td>
                    <td><input type="text" class="close-wins w-full" readonly></td>
                    <td><input type="text" class="close-losses w-full" readonly></td>
                    <td><input type="text" class="dominant-wins w-full" readonly></td>
                    <td><input type="text" class="best-partner w-full" readonly></td>
                    <td><input type="text" class="worst-partner w-full" readonly></td>
                </tr>
                <tr>
                    <td>6</td>
                    <td><input type="text" placeholder="이름" class="ranking-player w-full"></td>
                    <td><input type="text" class="mmr w-full" readonly></td>
                    <td><input type="text" class="wins w-full" readonly></td>
                    <td><input type="text" class="losses w-full" readonly></td>
                    <td><input type="text" class="game-diff w-full" readonly></td>
                    <td><input type="text" class="close-wins w-full" readonly></td>
                    <td><input type="text" class="close-losses w-full" readonly></td>
                    <td><input type="text" class="dominant-wins w-full" readonly></td>
                    <td><input type="text" class="best-partner w-full" readonly></td>
                    <td><input type="text" class="worst-partner w-full" readonly></td>
                </tr>
                <tr>
                    <td>7</td>
                    <td><input type="text" placeholder="이름" class="ranking-player w-full"></td>
                    <td><input type="text" class="mmr w-full" readonly></td>
                    <td><input type="text" class="wins w-full" readonly></td>
                    <td><input type="text" class="losses w-full" readonly></td>
                    <td><input type="text" class="game-diff w-full" readonly></td>
                    <td><input type="text" class="close-wins w-full" readonly></td>
                    <td><input type="text" class="close-losses w-full" readonly></td>
                    <td><input type="text" class="dominant-wins w-full" readonly></td>
                    <td><input type="text" class="best-partner w-full" readonly></td>
                    <td><input type="text" class="worst-partner w-full" readonly></td>
                </tr>
                <tr>
                    <td>8</td>
                    <td><input type="text" placeholder="이름" class="ranking-player w-full"></td>
                    <td><input type="text" class="mmr w-full" readonly></td>
                    <td><input type="text" class="wins w-full" readonly></td>
                    <td><input type="text" class="losses w-full" readonly></td>
                    <td><input type="text" class="game-diff w-full" readonly></td>
                    <td><input type="text" class="close-wins w-full" readonly></td>
                    <td><input type="text" class="close-losses w-full" readonly></td>
                    <td><input type="text" class="dominant-wins w-full" readonly></td>
                    <td><input type="text" class="best-partner w-full" readonly></td>
                    <td><input type="text" class="worst-partner w-full" readonly></td>
                </tr>
                <tr>
                    <td>9</td>
                    <td><input type="text" placeholder="이름" class="ranking-player w-full"></td>
                    <td><input type="text" class="mmr w-full" readonly></td>
                    <td><input type="text" class="wins w-full" readonly></td>
                    <td><input type="text" class="losses w-full" readonly></td>
                    <td><input type="text" class="game-diff w-full" readonly></td>
                    <td><input type="text" class="close-wins w-full" readonly></td>
                    <td><input type="text" class="close-losses w-full" readonly></td>
                    <td><input type="text" class="dominant-wins w-full" readonly></td>
                    <td><input type="text" class="best-partner w-full" readonly></td>
                    <td><input type="text" class="worst-partner w-full" readonly></td>
                </tr>
                <tr>
                    <td>10</td>
                    <td><input type="text" placeholder="이름" class="ranking-player w-full"></td>
                    <td><input type="text" class="mmr w-full" readonly></td>
                    <td><input type="text" class="wins w-full" readonly></td>
                    <td><input type="text" class="losses w-full" readonly></td>
                    <td><input type="text" class="game-diff w-full" readonly></td>
                    <td><input type="text" class="close-wins w-full" readonly></td>
                    <td><input type="text" class="close-losses w-full" readonly></td>
                    <td><input type="text" class="dominant-wins w-full" readonly></td>
                    <td><input type="text" class="best-partner w-full" readonly></td>
                    <td><input type="text" class="worst-partner w-full" readonly></td>
                </tr>
                <tr>
                    <td>11</td>
                    <td><input type="text" placeholder="이름" class="ranking-player w-full"></td>
                    <td><input type="text" class="mmr w-full" readonly></td>
                    <td><input type="text" class="wins w-full" readonly></td>
                    <td><input type="text" class="losses w-full" readonly></td>
                    <td><input type="text" class="game-diff w-full" readonly></td>
                    <td><input type="text" class="close-wins w-full" readonly></td>
                    <td><input type="text" class="close-losses w-full" readonly></td>
                    <td><input type="text" class="dominant-wins w-full" readonly></td>
                    <td><input type="text" class="best-partner w-full" readonly></td>
                    <td><input type="text" class="worst-partner w-full" readonly></td>
                </tr>
                <tr>
                    <td>12</td>
                    <td><input type="text" placeholder="이름" class="ranking-player w-full"></td>
                    <td><input type="text" class="mmr w-full" readonly></td>
                    <td><input type="text" class="wins w-full" readonly></td>
                    <td><input type="text" class="losses w-full" readonly></td>
                    <td><input type="text" class="game-diff w-full" readonly></td>
                    <td><input type="text" class="close-wins w-full" readonly></td>
                    <td><input type="text" class="close-losses w-full" readonly></td>
                    <td><input type="text" class="dominant-wins w-full" readonly></td>
                    <td><input type="text" class="best-partner w-full" readonly></td>
                    <td><input type="text" class="worst-partner w-full" readonly></td>
                </tr>
                <tr>
                    <td>13</td>
                    <td><input type="text" placeholder="이름" class="ranking-player w-full"></td>
                    <td><input type="text" class="mmr w-full" readonly></td>
                    <td><input type="text" class="wins w-full" readonly></td>
                    <td><input type="text" class="losses w-full" readonly></td>
                    <td><input type="text" class="game-diff w-full" readonly></td>
                    <td><input type="text" class="close-wins w-full" readonly></td>
                    <td><input type="text" class="close-losses w-full" readonly></td>
                    <td><input type="text" class="dominant-wins w-full" readonly></td>
                    <td><input type="text" class="best-partner w-full" readonly></td>
                    <td><input type="text" class="worst-partner w-full" readonly></td>
                </tr>
                <tr>
                    <td>14</td>
                    <td><input type="text" placeholder="이름" class="ranking-player w-full"></td>
                    <td><input type="text" class="mmr w-full" readonly></td>
                    <td><input type="text" class="wins w-full" readonly></td>
                    <td><input type="text" class="losses w-full" readonly></td>
                    <td><input type="text" class="game-diff w-full" readonly></td>
                    <td><input type="text" class="close-wins w-full" readonly></td>
                    <td><input type="text" class="close-losses w-full" readonly></td>
                    <td><input type="text" class="dominant-wins w-full" readonly></td>
                    <td><input type="text" class="best-partner w-full" readonly></td>
                    <td><input type="text" class="worst-partner w-full" readonly></td>
                </tr>
                <tr>
                    <td>15</td>
                    <td><input type="text" placeholder="이름" class="ranking-player w-full"></td>
                    <td><input type="text" class="mmr w-full" readonly></td>
                    <td><input type="text" class="wins w-full" readonly></td>
                    <td><input type="text" class="losses w-full" readonly></td>
                    <td><input type="text" class="game-diff w-full" readonly></td>
                    <td><input type="text" class="close-wins w-full" readonly></td>
                    <td><input type="text" class="close-losses w-full" readonly></td>
                    <td><input type="text" class="dominant-wins w-full" readonly></td>
                    <td><input type="text" class="best-partner w-full" readonly></td>
                    <td><input type="text" class="worst-partner w-full" readonly></td>
                </tr>
            </table>
            <div style="text-align: center;">
                <button id="update-ranking" class="btn">순위 업데이트</button>
                <button id="download-csv" class="btn">CSV 다운로드</button>
            </div>
        </div>

        <div id="toast" class="toast">데이터 저장됨</div>

        <script type="module">
            // Firebase 모듈 가져오기
            import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
            import { getFirestore, collection, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js";
            import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-analytics.js";

            // Firebase 설정
            const firebaseConfig = {
                apiKey: "AIzaSyAlcszFYMqJjaJQHajx7K695zoeRS7PsxU",
                authDomain: "tennis-plan-jibung.firebaseapp.com",
                databaseURL: "https://tennis-plan-jibung-default-rtdb.firebaseio.com",
                projectId: "tennis-plan-jibung",
                storageBucket: "tennis-plan-jibung.firebasestorage.app",
                messagingSenderId: "491083537160",
                appId: "1:491083537160:web:0c2ec53b1285aa1cdc6abd",
                measurementId: "G-4CSJLPFJD6"
            };

            // Firebase 초기화
            let db = null;
            let analytics = null;
            try {
                if (!firebaseConfig.apiKey || !firebaseConfig.projectId) {
                    throw new Error('firebaseConfig가 비어 있거나 필수 값이 누락됨');
                }
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                if (firebaseConfig.measurementId) {
                    analytics = getAnalytics(app);
                }
            } catch (e) {
                console.error('Firebase 초기화 실패:', e.message);
                showToast('Firebase 설정 오류: 설정을 확인하세요');
            }

            // XLSX 처리 (IIFE로 중복 선언 방지)
            (function() {
                window.gk_isXlsx = false;
                window.gk_xlsxFileLookup = {};
                window.gk_fileData = {};

                function filledCell(cell) {
                    return cell !== '' && cell != null;
                }

                window.loadFileData = function(filename) {
                    if (gk_isXlsx && gk_xlsxFileLookup[filename] && typeof XLSX !== 'undefined') {
                        try {
                            const workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                            const firstSheetName = workbook.SheetNames[0];
                            const worksheet = workbook.Sheets[firstSheetName];
                            const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                            const filteredData = jsonData.filter(row => row.some(filledCell));
                            const headerRowIndex = filteredData.findIndex((row, index) =>
                                row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                            );
                            const finalIndex = headerRowIndex === -1 || headerRowIndex > 25 ? 0 : headerRowIndex;
                            const csv = XLSX.utils.sheet_to_csv(XLSX.utils.aoa_to_sheet(filteredData.slice(finalIndex)), { header: 1 });
                            return csv;
                        } catch (e) {
                            console.error('XLSX 로드 실패:', e);
                            return "";
                        }
                    }
                    return gk_fileData[filename] || "";
                };
            })();

            // Firestore에 저장
            async function saveToFirestore() {
                if (!db) {
                    showToast('Firestore 초기화 실패');
                    return;
                }
                try {
                    const scheduleRows = document.querySelectorAll('.schedule-table tr:not(:first-child)');
                    const scheduleData = [];
                    scheduleRows.forEach(row => {
                        const match = {
                            player1: row.querySelector('.player1').value.trim(),
                            player2: row.querySelector('.player2').value.trim(),
                            player3: row.querySelector('.player3').value.trim(),
                            player4: row.querySelector('.player4').value.trim(),
                            score: row.querySelector('.score').value.trim()
                        };
                        if (match.player1 || match.player2 || match.player3 || match.player4 || match.score) {
                            scheduleData.push(match);
                        }
                    });
                    await setDoc(doc(db, 'schedule', 'data'), { matches: scheduleData });

                    const rankingRows = document.querySelectorAll('#ranking-table tr:not(:first-child)');
                    const rankingData = [];
                    rankingRows.forEach(row => {
                        const player = {
                            name: row.querySelector('.ranking-player').value.trim(),
                            mmr: row.querySelector('.mmr').value,
                            wins: row.querySelector('.wins').value,
                            losses: row.querySelector('.losses').value,
                            gameDiff: row.querySelector('.game-diff').value,
                            closeWins: row.querySelector('.close-wins').value,
                            closeLosses: row.querySelector('.close-losses').value,
                            dominantWins: row.querySelector('.dominant-wins').value,
                            bestPartner: row.querySelector('.best-partner').value,
                            worstPartner: row.querySelector('.worst-partner').value
                        };
                        if (player.name) {
                            rankingData.push(player);
                        }
                    });
                    await setDoc(doc(db, 'rankings', 'data'), { players: rankingData });

                    showToast('데이터 저장됨');
                } catch (e) {
                    console.error('Firestore 저장 실패:', e.message);
                    showToast('데이터 저장 실패');
                }
            }

            // Firestore에서 로드
            async function loadFromFirestore() {
                if (!db) {
                    showToast('Firestore 초기화 실패');
                    return;
                }
                try {
                    const scheduleDoc = await getDoc(doc(db, 'schedule', 'data'));
                    const scheduleData = scheduleDoc.exists() ? scheduleDoc.data().matches : [];
                    const scheduleRows = document.querySelectorAll('.schedule-table tr:not(:first-child)');
                    scheduleData.forEach((match, index) => {
                        if (scheduleRows[index]) {
                            scheduleRows[index].querySelector('.player1').value = match.player1 || '';
                            scheduleRows[index].querySelector('.player2').value = match.player2 || '';
                            scheduleRows[index].querySelector('.player3').value = match.player3 || '';
                            scheduleRows[index].querySelector('.player4').value = match.player4 || '';
                            scheduleRows[index].querySelector('.score').value = match.score || '';
                        }
                    });

                    const rankingDoc = await getDoc(doc(db, 'rankings', 'data'));
                    const rankingData = rankingDoc.exists() ? rankingDoc.data().players : [];
                    const rankingRows = document.querySelectorAll('#ranking-table tr:not(:first-child)');
                    rankingData.forEach((player, index) => {
                        if (rankingRows[index]) {
                            rankingRows[index].querySelector('.ranking-player').value = player.name || '';
                            rankingRows[index].querySelector('.mmr').value = player.mmr || '';
                            rankingRows[index].querySelector('.wins').value = player.wins || '';
                            rankingRows[index].querySelector('.losses').value = player.losses || '';
                            rankingRows[index].querySelector('.game-diff').value = player.gameDiff || '';
                            rankingRows[index].querySelector('.close-wins').value = player.closeWins || '';
                            rankingRows[index].querySelector('.close-losses').value = player.closeLosses || '';
                            rankingRows[index].querySelector('.dominant-wins').value = player.dominantWins || '';
                            rankingRows[index].querySelector('.best-partner').value = player.bestPartner || '';
                            rankingRows[index].querySelector('.worst-partner').value = player.worstPartner || '';
                        }
                    });
                } catch (e) {
                    console.error('Firestore 로드 실패:', e.message);
                    showToast('데이터 로드 실패');
                }
            }

            // 토스트 알림
            function showToast(message) {
                const toast = document.getElementById('toast');
                toast.textContent = message;
                toast.classList.add('show');
                setTimeout(() => toast.classList.remove('show'), 3000);
            }

            // CSV 다운로드
            function downloadCSV() {
                try {
                    let rankingCSV = '\uFEFF순위,선수,MMR,승,패,게임득실,접전승률,접전패률,압도승률,최고승률 파트너,최하승률 파트너\n';
                    document.querySelectorAll('#ranking-table tr:not(:first-child)').forEach(row => {
                        const rank = row.cells[0].textContent;
                        const player = row.querySelector('.ranking-player').value;
                        const mmr = row.querySelector('.mmr').value;
                        const wins = row.querySelector('.wins').value;
                        const losses = row.querySelector('.losses').value;
                        const gameDiff = row.querySelector('.game-diff').value;
                        const closeWins = row.querySelector('.close-wins').value;
                        const closeLosses = row.querySelector('.close-losses').value;
                        const dominantWins = row.querySelector('.dominant-wins').value;
                        const bestPartner = row.querySelector('.best-partner').value;
                        const worstPartner = row.querySelector('.worst-partner').value;
                        if (player) {
                            rankingCSV += `${rank},"${player}",${mmr},${wins},${losses},${gameDiff},${closeWins},${closeLosses},${dominantWins},"${bestPartner}","${worstPartner}"\n`;
                        }
                    });

                    const blob = new Blob([rankingCSV], { type: 'text/csv;charset=utf-8;' });
                    const link = document.createElement('a');
                    const url = URL.createObjectURL(blob);
                    link.setAttribute('href', url);
                    link.setAttribute('download', 'raelangaros_rankings.csv');
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                } catch (e) {
                    console.error('CSV 다운로드 실패:', e);
                    showToast('CSV 다운로드 실패');
                }
            }

            // 순위 업데이트
            async function updateRanking() {
                if (!db) {
                    showToast('Firestore 초기화 실패');
                    return;
                }
                try {
                    const scheduleRows = document.querySelectorAll('.schedule-table tr:not(:first-child)');
                    const players = {};
                    const RAEMIN = "정래민";
                    const BASE_MMR = 1500;
                    const partnerStats = {};

                    // 초기 플레이어 세팅
                    document.querySelectorAll('.ranking-player').forEach(input => {
                        const name = input.value.trim();
                        if (name) {
                            players[name] = {
                                wins: 0,
                                losses: 0,
                                gameDiff: 0,
                                closeWins: 0,
                                closeLosses: 0,
                                closeSets: 0,
                                dominantWins: 0,
                                totalSets: 0,
                                partners: {},
                                mmr: BASE_MMR
                            };
                        }
                    });

                    // 경기 결과 계산
                    scheduleRows.forEach(row => {
                        const player1 = row.querySelector('.player1').value.trim();
                        const player2 = row.querySelector('.player2').value.trim();
                        const player3 = row.querySelector('.player3').value.trim();
                        const player4 = row.querySelector('.player4').value.trim();
                        const score = row.querySelector('.score').value.trim();

                        if (player1 && player2 && player3 && player4 && score) {
                            const [score1, score2] = score.split('-').map(Number);
                            if (isNaN(score1) || isNaN(score2)) return;

                            const isCloseSet = Math.abs(score1 - score2) <= 2;
                            const isDominantWin = (score1 === 6 && (score2 === 0 || score2 === 1)) || (score2 === 6 && (score1 === 0 || score1 === 1));
                            const team1MMR = ((players[player1]?.mmr || BASE_MMR) + (players[player2]?.mmr || BASE_MMR)) / 2;
                            const team2MMR = ((players[player3]?.mmr || BASE_MMR) + (players[player4]?.mmr || BASE_MMR)) / 2;
                            const expectedScore1 = 1 / (1 + Math.pow(10, (team2MMR - team1MMR) / 400));
                            const expectedScore2 = 1 - expectedScore1;
                            const K = isCloseSet ? 24 : 32;
                            const raeminK = isCloseSet ? 12 : 16;
                            const scoreMargin = Math.abs(score1 - score2);
                            const marginMultiplier = 1 + (scoreMargin > 4 ? 0.2 : scoreMargin > 2 ? 0.1 : 0);
                            const raeminWeight = [player1, player2, player3, player4].includes(RAEMIN) ? 1.2 : 1.0;

                            const updatePartnerStats = (p1, p2, isWin) => {
                                if (!partnerStats[p1]) partnerStats[p1] = {};
                                if (!partnerStats[p1][p2]) partnerStats[p1][p2] = { wins: 0, losses: 0, matches: 0 };
                                partnerStats[p1][p2].matches += 1;
                                if (isWin) {
                                    partnerStats[p1][p2].wins += 1;
                                } else {
                                    partnerStats[p1][p2].losses += 1;
                                }
                            };

                            const updatePlayer = (p, isWinner, diff, isClose, isDominant, mmrChange) => {
                                if (!players[p]) {
                                    players[p] = {
                                        wins: 0,
                                        losses: 0,
                                        gameDiff: 0,
                                        closeWins: 0,
                                        closeLosses: 0,
                                        closeSets: 0,
                                        dominantWins: 0,
                                        totalSets: 0,
                                        partners: {},
                                        mmr: BASE_MMR
                                    };
                                }
                                if (isWinner) {
                                    players[p].wins += 1;
                                    if (isClose) players[p].closeWins += 1;
                                    if (isDominant) players[p].dominantWins += 1;
                                } else {
                                    players[p].losses += 1;
                                    if (isClose) players[p].closeLosses += 1;
                                }
                                players[p].gameDiff += diff;
                                players[p].totalSets += 1;
                                if (isClose) players[p].closeSets += 1;
                                const baseMMRChange = (p === RAEMIN ? raeminK : K) * mmrChange * raeminWeight / 2;
                                players[p].mmr += baseMMRChange;
                                if (p === RAEMIN) {
                                    players[p].mmr = players[p].mmr * 0.95 + BASE_MMR * 0.05;
                                }
                            };

                            if (score1 > score2) {
                                updatePlayer(player1, true, score1 - score2, isCloseSet, score1 === 6 && (score2 === 0 || score2 === 1), (1 - expectedScore1) * marginMultiplier);
                                updatePlayer(player2, true, score1 - score2, isCloseSet, score1 === 6 && (score2 === 0 || score2 === 1), (1 - expectedScore1) * marginMultiplier);
                                updatePlayer(player3, false, score2 - score1, isCloseSet, false, (0 - expectedScore2) * marginMultiplier);
                                updatePlayer(player4, false, score2 - score1, isCloseSet, false, (0 - expectedScore2) * marginMultiplier);
                                updatePartnerStats(player1, player2, true);
                                updatePartnerStats(player2, player1, true);
                                updatePartnerStats(player3, player4, false);
                                updatePartnerStats(player4, player3, false);
                            } else {
                                updatePlayer(player3, true, score2 - score1, isCloseSet, score2 === 6 && (score1 === 0 || score1 === 1), (1 - expectedScore2) * marginMultiplier);
                                updatePlayer(player4, true, score2 - score1, isCloseSet, score2 === 6 && (score1 === 0 || score1 === 1), (1 - expectedScore2) * marginMultiplier);
                                updatePlayer(player1, false, score1 - score2, isCloseSet, false, (0 - expectedScore1) * marginMultiplier);
                                updatePlayer(player2, false, score1 - score2, isCloseSet, false, (0 - expectedScore1) * marginMultiplier);
                                updatePartnerStats(player3, player4, true);
                                updatePartnerStats(player4, player3, true);
                                updatePartnerStats(player1, player2, false);
                                updatePartnerStats(player2, player1, false);
                            }
                        }
                    });

                    // 정렬: MMR > 승 > 게임득실
                    const sortedPlayers = Object.entries(players).map(([name, data]) => ({
                        name,
                        ...data
                    })).sort((a, b) => {
                        if (b.mmr !== a.mmr) return b.mmr - a.mmr;
                        if (b.wins !== a.wins) return b.wins - a.wins;
                        return b.gameDiff - a.gameDiff;
                    });

                    // 순위 테이블 반영
                    const rankingRows = document.querySelectorAll('#ranking-table tr:not(:first-child)');
                    sortedPlayers.forEach((player, i) => {
                        const row = rankingRows[i];
                        if (!row) return;
                        row.cells[0].textContent = i + 1;
                        row.querySelector('.ranking-player').value = player.name;
                        row.querySelector('.mmr').value = Math.round(player.mmr);
                        row.querySelector('.wins').value = player.wins;
                        row.querySelector('.losses').value = player.losses;
                        row.querySelector('.game-diff').value = player.gameDiff;
                        row.querySelector('.close-wins').value = player.closeSets > 0 ? Math.round((player.closeWins / player.closeSets) * 100) : '';
                        row.querySelector('.close-losses').value = player.closeSets > 0 ? Math.round((player.closeLosses / player.closeSets) * 100) : '';
                        row.querySelector('.dominant-wins').value = player.totalSets > 0 ? Math.round((player.dominantWins / player.totalSets) * 100) : '';

                        // 최고/최하 승률 파트너 계산
                        let bestPartner = '', bestWinRate = -1, worstPartner = '', worstWinRate = 101;
                        if (partnerStats[player.name]) {
                            Object.entries(partnerStats[player.name]).forEach(([partner, stats]) => {
                                const matches = stats.matches;
                                let winRate;
                                if (player.name === RAEMIN && matches < 3) {
                                    winRate = (stats.wins + 0.5 * (3 - matches)) / (stats.wins + stats.losses + (3 - matches)) * 100;
                                } else {
                                    winRate = stats.wins + stats.losses > 0 ? (stats.wins / (stats.wins + stats.losses)) * 100 : 0;
                                }
                                if (winRate > bestWinRate) {
                                    bestWinRate = winRate;
                                    bestPartner = `${partner} (${Math.round(winRate)}%)`;
                                }
                                if (winRate < worstWinRate) {
                                    worstWinRate = winRate;
                                    worstPartner = `${partner} (${Math.round(winRate)}%)`;
                                }
                            });
                        }
                        row.querySelector('.best-partner').value = bestPartner || '-';
                        row.querySelector('.worst-partner').value = worstPartner || '-';
                    });

                    await saveToFirestore();
                } catch (e) {
                    console.error('순위 업데이트 실패:', e.message);
                    showToast('순위 업데이트 실패');
                }
            }

            // 입력 변경 시 Firestore 저장
            function setupInputListeners() {
                document.querySelectorAll('.schedule-table input').forEach(input => {
                    input.addEventListener('change', saveToFirestore);
                });
            }

            // 이벤트 리스너
            try {
                document.getElementById('update-ranking').addEventListener('click', updateRanking);
                document.getElementById('download-csv').addEventListener('click', downloadCSV);
                window.addEventListener('load', () => {
                    loadFromFirestore();
                    setupInputListeners();
                });
            } catch (e) {
                console.error('이벤트 리스너 설정 실패:', e.message);
                showToast('앱 초기화 실패');
            }
        </script>
    </div>
</body>
</html>